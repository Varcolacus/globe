<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Debug - Country Selector</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        .test-panel {
            background: #16213e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        button {
            background: #0f3460;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #164470;
        }
        .log {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .log div {
            margin: 4px 0;
            padding: 4px;
            border-left: 3px solid #444;
            padding-left: 10px;
        }
        .success { color: #4caf50; border-left-color: #4caf50 !important; }
        .error { color: #f44336; border-left-color: #f44336 !important; }
        .info { color: #2196f3; border-left-color: #2196f3 !important; }
        .warning { color: #ff9800; border-left-color: #ff9800 !important; }
        h1 { color: #00d9ff; }
        h2 { color: #ffa500; }
        .current-country {
            font-size: 24px;
            padding: 15px;
            background: #0f3460;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }
        .data-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .data-card {
            background: #0f3460;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .data-card .label {
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
        }
        .data-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #00d9ff;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Test Debug - Changement de Pays Source</h1>
    
    <div class="test-panel">
        <h2>Pays Source Actuel</h2>
        <div class="current-country" id="current-country">ğŸ‡«ğŸ‡· France</div>
        
        <h2>Actions de Test</h2>
        <button onclick="testCountryChange('France')">ğŸ‡«ğŸ‡· Charger France</button>
        <button onclick="testCountryChange('Canada')">ğŸ‡¨ğŸ‡¦ Charger Canada</button>
        <button onclick="testCountryChange('Allemagne')">ğŸ‡©ğŸ‡ª Charger Allemagne</button>
        <button onclick="testCountryChange('Ã‰tats-Unis')">ğŸ‡ºğŸ‡¸ Charger USA</button>
        <button onclick="testCountryChange('Chine')">ğŸ‡¨ğŸ‡³ Charger Chine</button>
        <button onclick="testCountryChange('Japon')">ğŸ‡¯ğŸ‡µ Charger Japon</button>
        <button onclick="clearLogs()" style="background: #d32f2f;">ğŸ—‘ï¸ Effacer Logs</button>
    </div>
    
    <div class="test-panel">
        <h2>RÃ©sumÃ© des DonnÃ©es</h2>
        <div class="data-summary" id="data-summary">
            <div class="data-card">
                <div class="label">Pays dans balanceData</div>
                <div class="value" id="data-length">-</div>
            </div>
            <div class="data-card">
                <div class="label">Pays avec commerce</div>
                <div class="value" id="trade-count">-</div>
            </div>
            <div class="data-card">
                <div class="label">Balance pays source</div>
                <div class="value" id="source-balance">-</div>
            </div>
            <div class="data-card">
                <div class="label">Version app.js</div>
                <div class="value" id="app-version">-</div>
            </div>
        </div>
        
        <h3 style="margin-top: 20px;">Top 5 Partenaires Commerciaux</h3>
        <div id="top-partners" style="background: #0f3460; padding: 15px; border-radius: 8px; font-size: 14px;"></div>
    </div>
    
    <div class="test-panel">
        <h2>Console de Debug</h2>
        <div class="log" id="log"></div>
    </div>

    <!-- DÃ©finir countries AVANT le chargement des scripts API -->
    <script>
        // Liste complÃ¨te des pays (required by api-config.js)
        const countries = [
            { lat: 46.2276, lng: 2.2137, name: 'France', capital: 'Paris', flag: 'ğŸ‡«ğŸ‡·', region: 'Europe' },
            { lat: 56.1304, lng: -106.3468, name: 'Canada', capital: 'Ottawa', flag: 'ğŸ‡¨ğŸ‡¦' , region: 'AmÃ©riques' },
            { lat: 51.1657, lng: 10.4515, name: 'Allemagne', capital: 'Berlin', flag: 'ğŸ‡©ğŸ‡ª' , region: 'Europe' },
            { lat: 37.0902, lng: -95.7129, name: 'Ã‰tats-Unis', capital: 'Washington DC', flag: 'ğŸ‡ºğŸ‡¸' , region: 'AmÃ©riques' },
            { lat: 35.8617, lng: 104.1954, name: 'Chine', capital: 'Beijing', flag: 'ğŸ‡¨ğŸ‡³' , region: 'Asie' },
            { lat: 36.2048, lng: 138.2529, name: 'Japon', capital: 'Tokyo', flag: 'ğŸ‡¯ğŸ‡µ' , region: 'Asie' },
            { lat: 55.3781, lng: -3.4360, name: 'Royaume-Uni', capital: 'Londres', flag: 'ğŸ‡¬ğŸ‡§' , region: 'Europe' },
            { lat: 41.8719, lng: 12.5674, name: 'Italie', capital: 'Rome', flag: 'ğŸ‡®ğŸ‡¹' , region: 'Europe' },
            { lat: 40.4637, lng: -3.7492, name: 'Espagne', capital: 'Madrid', flag: 'ğŸ‡ªğŸ‡¸' , region: 'Europe' },
            { lat: 19.4326, lng: -99.1332, name: 'Mexique', capital: 'Mexico', flag: 'ğŸ‡²ğŸ‡½' , region: 'AmÃ©riques' },
            { lat: -14.2350, lng: -51.9253, name: 'BrÃ©sil', capital: 'BrasÃ­lia', flag: 'ğŸ‡§ğŸ‡·' , region: 'AmÃ©riques' },
            { lat: 20.5937, lng: 78.9629, name: 'Inde', capital: 'New Delhi', flag: 'ğŸ‡®ğŸ‡³' , region: 'Asie' },
            { lat: 61.5240, lng: 105.3188, name: 'Russie', capital: 'Moscou', flag: 'ğŸ‡·ğŸ‡º' , region: 'Europe' },
            { lat: 37.5665, lng: 126.9780, name: 'CorÃ©e du Sud', capital: 'SÃ©oul', flag: 'ğŸ‡°ğŸ‡·' , region: 'Asie' },
            { lat: -25.2744, lng: 133.7751, name: 'Australie', capital: 'Canberra', flag: 'ğŸ‡¦ğŸ‡º' , region: 'OcÃ©anie' },
            { lat: 52.3676, lng: 4.9041, name: 'Pays-Bas', capital: 'Amsterdam', flag: 'ğŸ‡³ğŸ‡±' , region: 'Europe' },
            { lat: 50.5039, lng: 4.4699, name: 'Belgique', capital: 'Bruxelles', flag: 'ğŸ‡§ğŸ‡ª' , region: 'Europe' },
            { lat: 46.9479, lng: 7.4474, name: 'Suisse', capital: 'Berne', flag: 'ğŸ‡¨ğŸ‡­' , region: 'Europe' },
            { lat: 52.2297, lng: 21.0122, name: 'Pologne', capital: 'Varsovie', flag: 'ğŸ‡µğŸ‡±' , region: 'Europe' },
            { lat: 59.3293, lng: 18.0686, name: 'SuÃ¨de', capital: 'Stockholm', flag: 'ğŸ‡¸ğŸ‡ª' , region: 'Europe' },
            { lat: 39.9334, lng: 32.8597, name: 'Turquie', capital: 'Ankara', flag: 'ğŸ‡¹ğŸ‡·' , region: 'Asie' },
            { lat: 24.7136, lng: 46.6753, name: 'Arabie saoudite', capital: 'Riyad', flag: 'ğŸ‡¸ğŸ‡¦' , region: 'Asie' },
            { lat: -25.7479, lng: 28.2293, name: 'Afrique du Sud', capital: 'Pretoria', flag: 'ğŸ‡¿ğŸ‡¦' , region: 'Afrique' },
            { lat: 13.7563, lng: 100.5018, name: 'ThaÃ¯lande', capital: 'Bangkok', flag: 'ğŸ‡¹ğŸ‡­' , region: 'Asie' },
            { lat: -6.2088, lng: 106.8456, name: 'IndonÃ©sie', capital: 'Jakarta', flag: 'ğŸ‡®ğŸ‡©' , region: 'Asie' }
        ];
        console.log('âœ… Liste des pays chargÃ©e:', countries.length, 'pays');
    </script>

    <!-- Chargement des scripts -->
    <script src="national-apis-config.js?v=20260206f"></script>
    <script src="api-config.js?v=20260206f"></script>
    
    <script>
        let currentSourceCountry = 'France';
        let balanceData = [];
        const currentYear = 2025;
        
        // Logs
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('log').innerHTML = '';
            addLog('Logs effacÃ©s', 'info');
        }
        
        // Test changement de pays
        async function testCountryChange(country) {
            addLog(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'info');
            addLog(`ğŸ³ï¸ Changement de pays source: ${country}`, 'info');
            
            const oldCountry = currentSourceCountry;
            const oldDataLength = balanceData.length;
            const oldTop = balanceData.length > 0 ? balanceData.filter(c => c.volume > 0).sort((a,b) => b.volume - a.volume).slice(0,3).map(c => c.name).join(', ') : '-';
            
            currentSourceCountry = country;
            document.getElementById('current-country').textContent = getFlagEmoji(country) + ' ' + country;
            
            addLog(`Avant: ${oldCountry}, ${oldDataLength} pays, Top: ${oldTop}`, 'warning');
            addLog(`Appel de API_CONFIG.fetchBalancePaiements(${currentYear}, "${country}")...`, 'info');
            
            try {
                const startTime = Date.now();
                const response = await API_CONFIG.fetchBalancePaiements(currentYear, country);
                const duration = Date.now() - startTime;
                
                balanceData = response.data || response;
                
                addLog(`âœ… DonnÃ©es chargÃ©es en ${duration}ms`, 'success');
                addLog(`AprÃ¨s: ${country}, ${balanceData.length} pays`, 'success');
                
                // RÃ©sumÃ©
                const sourceEntry = balanceData.find(c => c.name === currentSourceCountry);
                const tradeCount = balanceData.filter(c => c.volume > 0 && c.name !== currentSourceCountry).length;
                const top5 = balanceData
                    .filter(c => c.volume > 0 && c.name !== currentSourceCountry)
                    .sort((a, b) => b.volume - a.volume)
                    .slice(0, 5);
                
                document.getElementById('data-length').textContent = balanceData.length;
                document.getElementById('trade-count').textContent = tradeCount;
                document.getElementById('source-balance').textContent = sourceEntry ? sourceEntry.balance : 'N/A';
                
                // Top partners
                const topHTML = top5.map((c, i) => 
                    `${i+1}. <strong>${c.name}</strong>: ${(c.volume/1000).toFixed(1)}Mdâ‚¬ (Exp: ${(c.exports/1000).toFixed(1)}Md, Imp: ${(c.imports/1000).toFixed(1)}Md)`
                ).join('<br>');
                document.getElementById('top-partners').innerHTML = topHTML || 'Aucun partenaire';
                
                addLog(`ğŸ“Š Top 5: ${top5.map(c => c.name).join(', ')}`, 'success');
                
                // Comparer avec avant
                if (oldDataLength > 0 && oldTop !== top5.map(c => c.name).slice(0,3).join(', ')) {
                    addLog(`âœ… CHANGEMENT DÃ‰TECTÃ‰: Les partenaires ont changÃ©!`, 'success');
                } else if (oldDataLength > 0) {
                    addLog(`âš ï¸ ATTENTION: Les mÃªmes partenaires apparaissent!`, 'error');
                }
                
            } catch (error) {
                addLog(`âŒ Erreur: ${error.message}`, 'error');
                console.error(error);
            }
            
            addLog(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'info');
        }
        
        function getFlagEmoji(country) {
            const flags = {
                'France': 'ğŸ‡«ğŸ‡·',
                'Canada': 'ğŸ‡¨ğŸ‡¦',
                'Allemagne': 'ğŸ‡©ğŸ‡ª',
                'Ã‰tats-Unis': 'ğŸ‡ºğŸ‡¸',
                'Chine': 'ğŸ‡¨ğŸ‡³',
                'Japon': 'ğŸ‡¯ğŸ‡µ'
            };
            return flags[country] || 'ğŸ³ï¸';
        }
        
        // Au chargement
        window.addEventListener('load', () => {
            addLog('ğŸš€ Page de test chargÃ©e', 'success');
            addLog('API_CONFIG disponible: ' + (typeof API_CONFIG !== 'undefined'), 'info');
            addLog('Version attendue: 20260206f', 'info');
            
            // DÃ©tecter la version
            const scripts = document.querySelectorAll('script[src*="api-config.js"]');
            scripts.forEach(s => addLog('Script chargÃ©: ' + s.src, 'info'));
            
            document.getElementById('app-version').textContent = '20260206f';
            
            // Charger France au dÃ©marrage
            setTimeout(() => testCountryChange('France'), 500);
        });
    </script>
</body>
</html>
